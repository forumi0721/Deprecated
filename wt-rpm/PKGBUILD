# Maintainer: StoneCold <forumi0721[at]gmail[dot]com>

pkgname=("wt-rpm")
pkgver=20150107
pkgrel=1
pkgdesc="Remote Power Managemant"
arch=("armv6h" "armv7h")
url="https://gitorious.org/wt-rpm"
license=("GPL")
depends=("wt" "wiringpi" "boost-libs" "liboping")
makedepends=("wt" "wiringpi" "boost" "gcc" "cmake" "liboping")
optdepends=("nginx: authentication  support")
install="${pkgname}.install"
source=("${pkgname}.zip"
	"${pkgname}.json")
md5sums=("SKIP"
	"SKIP")

pkgver() {
  date +'%Y%m%d'
}

build() {
	cd "${srcdir}"/"${pkgname}"

	mkdir -p build
	cd build
	cmake .. -DCMAKE_INSTALL_PREFIX=${pkgdir}/usr -DUSE_CON_HTTP=ON -USE_RASPRPM=ON -DUSE_DUMMY_RPM=ON -DUSE_PING=ON
	make
}

package() {
	cd "${srcdir}"/"${pkgname}"/build
	make install

	install -dm0755 "${pkgdir}"/usr/share/wtrpm
	install -Dm0644 "${srcdir}"/"${pkgname}"/imgs/ping.png "${pkgdir}"/usr/share/wtrpm/
	install -Dm0644 "${srcdir}"/"${pkgname}"/imgs/green_light.png "${pkgdir}"/usr/share/wtrpm/
	install -Dm0644 "${srcdir}"/"${pkgname}"/imgs/off_light.png "${pkgdir}"/usr/share/wtrpm/
	install -Dm0644 "${srcdir}"/"${pkgname}"/imgs/power-button.png "${pkgdir}"/usr/share/wtrpm/

	install -dm0755 "${pkgdir}"/etc
	install -Dm0644 "${srcdir}"/wt-rpm.json "${pkgdir}"/etc/

	install -dm0755 "${pkgdir}"/usr/lib/systemd/system
	install -Dm0644 "${srcdir}"/"${pkgname}"/systemd/wtrpm.service "${pkgdir}"/usr/lib/systemd/system/
}

# vim:set ts=2 sw=2 et:
