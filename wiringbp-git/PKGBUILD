# Maintainer: StoneCold <forumi0721[at]gmail[dot]com>

pkgname=("wiringbp-git")
pkgver=20141222
pkgrel=1
pkgdesc="WiringBP: An implementation of most of the Arduino Wiring functions for the Banana Pi"
arch=("armv7h")
url="https://github.com/LeMaker/WiringBP/"
license=("LGPL")
makedepends=("git")
provides=("wiringpi") 
conflicts=("wiringpi")
source=("${pkgname}::git+https://github.com/LeMaker/WiringBP")
md5sums=("SKIP")

prepare() {
	cd "${pkgname}"
	sed -i "s|/usr/local/bin/gpio|/usr/bin/gpio|" wiringPi/wiringPi.c
}

build() {
	cd "${pkgname}"

	make -C wiringPi all static
	make -C devLib all static INCLUDE+="-I${srcdir}/${pkgname}/wiringPi" LDFLAGS+="-L${srcdir}/${pkgname}/wiringPi"
	make -C gpio INCLUDE+="-I${srcdir}/${pkgname}/wiringPi -I${srcdir}/${pkgname}/devLib" LDFLAGS+="-L${srcdir}/${pkgname}/wiringPi -L${srcdir}/${pkgname}/devLib"
}

package(){
	cd "${pkgdir}"

	install -dm0755 "${pkgdir}"/usr/include
	install -Dm0644 "${srcdir}"/"${pkgname}"/wiringPi/*.h "${pkgdir}"/usr/include/
	install -dm0755 "${pkgdir}"/usr/lib
	install -Dm0644 "${srcdir}"/"${pkgname}"/wiringPi/libwiringPi.{a,so*} "${pkgdir}"/usr/lib/
	
	install -dm0755 "${pkgdir}"/usr/include
	install -Dm0644 "${srcdir}"/"${pkgname}"/devLib/*.h "${pkgdir}"/usr/include/
	install -dm0755 "${pkgdir}"/usr/lib
	install -Dm0644 "${srcdir}"/"${pkgname}"/devLib/libwiringPiDev.{a,so*} "${pkgdir}"/usr/lib
	
	install -dm0755 "${pkgdir}"/usr/bin
	install -Dm4755 "${srcdir}"/"${pkgname}"/gpio/gpio "${pkgdir}"/usr/bin/
	install -dm0755 "${pkgdir}"/usr/share/man/man1
	install -Dm0644 "${srcdir}"/"${pkgname}"/gpio/gpio.1 "${pkgdir}"/usr/share/man/man1/
}

# vim:set ts=2 sw=2 et:
