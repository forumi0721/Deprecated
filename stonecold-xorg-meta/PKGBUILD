# Maintainer: StoneCold <forumi0721[at]gmail[dot]com>

pkgname=("stonecold-xorg-meta")
pkgver=20150217.2
pkgrel=1
pkgdesc="Install xorg packages"
arch=("x86_64" "armv7h")
url="http://localhost/"
license=("Other")
depends=(
  "gvfs"
  "gvfs-afp"
  "gvfs-mtp"
  "gvfs-smb"
  "lightdm"
  "lightdm-gtk3-greeter"
  "tango-icon-theme"
  "tigervnc"
  "ttf-bitstream-vera-sans-mono"
  "ttf-nanum-fonts"
  "ttf-win81-fonts-korean"
  "wxgtk2.8"
)
depends+=(
  "chromium"
  "gimp"
  "gvim"
  "kodi"
  "kodi-pvr-addons"
  "libreoffice-fresh"
  "libreoffice-fresh-ko"
  "nabi-git"
  "sylpheed"
)
depends_x86_64+=(
  "chromium-pepper-flash"
  "libva-intel-driver"
  "libvdpau-va-gl"
)
install="${pkgname}.install"
source=(
  "etc.zip"
)
md5sums=(
  "SKIP"
)
source_x86_64+=(
  "etc_x86_64.zip"
)
md5sums_x86_64+=(
  "SKIP"
)

pkgver() {
  local ldate="$(date +'%Y%m%d')"
  local lrevision=0
  local lrevision2=0
  local larch=${arch}
  if [ "${larch}" != "any" ]; then
    larch="${CARCH}"
  fi
  for file in $(ls "${startdir}"/${pkgname}-${ldate}.*-${pkgrel}-${larch}.pkg.* 2> /dev/null)
  do
    lrevision2="$(echo $(basename "${file}") | sed -e "s/${pkgname}-${ldate}.//g" -e "s/-${pkgrel}-${larch}.pkg\..*//g" 2> /dev/null)"
    if [ "${lrevision2}" > 0 ] && [ "${lrevision}" -lt "${lrevision2}" ]; then
      lrevision=${lrevision2}
    fi
  done
  lrevision=$(($lrevision + 1))
  echo "${ldate}.${lrevision}"
}

package() {
  install -dm755 "${pkgdir}"/etc/
  install -Dm644 "${srcdir}"/etc/xprofile "${pkgdir}"/etc/
  install -dm755 "${pkgdir}"/etc/lightdm
  install -Dm755 "${srcdir}"/etc/lightdm/display-setup-script.sh "${pkgdir}"/etc/lightdm/
  install -Dm600 "${srcdir}"/etc/lightdm/vncpasswd "${pkgdir}"/etc/lightdm/
  if [ "${CARCH}" = "x86_64" ]; then
    install -dm755 "${pkgdir}"/etc/modprobe.d
    install -Dm644 "${srcdir}"/etc/modprobe.d/i915.conf "${pkgdir}"/etc/modprobe.d/
    install -dm755 "${pkgdir}"/etc/profile.d
    install -Dm755 "${srcdir}"/etc/profile.d/libva_driver_name.sh "${pkgdir}"/etc/profile.d/
    install -Dm755 "${srcdir}"/etc/profile.d/vdpau_driver.sh "${pkgdir}"/etc/profile.d/
    install -dm755 "${pkgdir}"/etc/X11/xorg.conf.d
    install -Dm644 "${srcdir}"/etc/X11/xorg.conf.d/20-intel.conf "${pkgdir}"/etc/X11/xorg.conf.d/
  fi
}

# vim:set ts=2 sw=2 et:
