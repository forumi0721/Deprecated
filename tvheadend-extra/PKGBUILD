# Maintainer: StoneCold <forumi0721[at]gmail[dot]com>

_localpkgver=Y
pkgname=("tvheadend-extra")
pkgver=20150224.1
pkgrel=1
pkgdesc="tvheadend extra EPG and frequencies"
arch=("any")
url="https://tvheadend.org/"
license=("custom")
depends=("tvheadend" "mc2xml-bin")
source=(
  "mc2xml.tar.xz"
  "kr-Cable-C&M-center-frequencies-QAM256_8VSB"
)
md5sums=(
  "f5c376096a0665d78fdd2777d1070173"
  "c6cfcf15874a7ff8d0796266390d62b0"
)

pkgver() {
  local ldate="$(date +'%Y%m%d')"
  local lrevision=0
  local lrevision2=0
  local larch=${arch}
  if [ "${larch}" != "any" ]; then
    larch="${CARCH}"
  fi
  for file in $(ls "${startdir}"/${pkgname}-${ldate}.*-${pkgrel}-${larch}.pkg.* 2> /dev/null)
  do
    lrevision2="$(echo $(basename "${file}") | sed -e "s/${pkgname}-${ldate}.//g" -e "s/-${pkgrel}-${larch}.pkg\..*//g" 2> /dev/null)"
    if [ "${lrevision2}" > 0 ] && [ "${lrevision}" -lt "${lrevision2}" ]; then
      lrevision=${lrevision2}
    fi
  done
  lrevision=$(($lrevision + 1))
  echo "${ldate}.${lrevision}"
}

package() {
	install -dm0755 "${pkgdir}"/usr/share/tvheadend/data/dvb-scan/atsc
	install -Dm0644 "${srcdir}"/kr-*-frequencies-* "${pkgdir}"/usr/share/tvheadend/data/dvb-scan/atsc/

	install -dm0755 "${pkgdir}"/usr/lib/systemd/system
	install -Dm0644 "${srcdir}"/mc2xml/usr/lib/systemd/system/mc2xml.service "${pkgdir}"/usr/lib/systemd/system/
	install -Dm0644 "${srcdir}"/mc2xml/usr/lib/systemd/system/mc2xml.timer "${pkgdir}"/usr/lib/systemd/system

	install -dm0755 "${pkgdir}"/usr/bin
	install -Dm0755 "${srcdir}"/mc2xml/usr/bin/tv_grab_mc2xml "${pkgdir}"/usr/bin/

	install -dm0755 "${pkgdir}"/var/mc2xml
	install -Dm0755 "${srcdir}"/mc2xml/var/mc2xml/mc2xml.sh "${pkgdir}"/var/mc2xml/
	install -Dm0644 "${srcdir}"/mc2xml/var/mc2xml/mc2xml_U+_TV.dat "${pkgdir}"/var/mc2xml/
	install -Dm0644 "${srcdir}"/mc2xml/var/mc2xml/mc2xml_U+_TV.chl "${pkgdir}"/var/mc2xml/
	install -Dm0644 "${srcdir}"/mc2xml/var/mc2xml/mc2xml_U+_TV.ren "${pkgdir}"/var/mc2xml/
	install -Dm0644 "${srcdir}"/mc2xml/var/mc2xml/xmltv_U+_TV.xml.gz "${pkgdir}"/var/mc2xml/
	install -Dm0644 "${srcdir}"/mc2xml/var/mc2xml/mc2xml_C\&M.dat "${pkgdir}"/var/mc2xml/
	install -Dm0644 "${srcdir}"/mc2xml/var/mc2xml/mc2xml_C\&M.chl "${pkgdir}"/var/mc2xml/
	install -Dm0644 "${srcdir}"/mc2xml/var/mc2xml/mc2xml_C\&M.ren "${pkgdir}"/var/mc2xml/
	install -Dm0644 "${srcdir}"/mc2xml/var/mc2xml/xmltv_C\&M.xml.gz "${pkgdir}"/var/mc2xml/
	install -Dm0644 "${srcdir}"/mc2xml/var/mc2xml/xmltv.xml.gz "${pkgdir}"/var/mc2xml/
}

# vim:set ts=2 sw=2 et:
