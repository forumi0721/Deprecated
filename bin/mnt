#!/bin/sh

if [ "${UID}" != "0" ]; then
	sudo $0 $*
	exit $?
fi

#hostname:ip:user:pass:auth:mountpath
SERVERS=(
"StoneColdPC:192.168.0.11:forumi0721:rlaqhrua1:nounix,sec=ntlmssp:Data"
"StoneColdNAS:192.168.0.21:forumi0721:rlaqhrua1:sec=ntlmv2:StoneColdNAS"
"StoneColdPogo:192.168.0.22:forumi0721:rlaqhrua1:sec=ntlmv2:StoneColdPogo"
"StoneColdPi:192.168.0.31:forumi0721:rlaqhrua1:sec=ntlmv2:StoneColdPi"
)

HOSTNAME="$(hostname)"
HOSTIP="$(ip addr | grep 'state UP' -A2 | tail -n1 | awk '{print $2}' | cut -f1  -d'/')" 
MOUNT_ROOT=

if [ "${HOSTNAME}" = "StoneColdPC" ]; then
	MOUNT_ROOT=/Volumes
else
	MOUNT_ROOT=/media
fi

for server in ${SERVERS[@]}
do
	name="$(echo "${server}" | cut -d ':' -f 1)"
	ip="$(echo "${server}" | cut -d ':' -f 2)"
	user="$(echo "${server}" | cut -d ':' -f 3)"
	pass="$(echo "${server}" | cut -d ':' -f 4)"
	sec="$(echo "${server}" | cut -d ':' -f 5)"
	path="$(echo "${server}" | cut -d ':' -f 6)"

	if [ -z "${name}" ] || [ -z "${ip}" ] || [ "${name}" = "${HOSTNAME}" ] || [ "${ip}" = "${HOSTIP}" ]; then
		echo "Skip ${name}"
		continue
	fi

	if [ -z "`mount | grep "${MOUNT_ROOT}/${name}"`" ]; then
		ping -c 1 -W 1 "${ip}" &> /dev/null
		if [ $? -eq 0 ]; then
			echo "Mount ${name}"
			mkdir -p ${MOUNT_ROOT}/${name}
			mount -o user=${user},pass=${pass},${sec} //${ip}/${path} ${MOUNT_ROOT}/${name}
		else
			echo "Cannot connect ${name}"
		fi
	else
		echo "${name} already mount"
	fi
done

exit 0

