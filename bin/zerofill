#!/bin/sh

if [ -z "${1}" ] || [ ! -d "${1}" ]; then
	echo "Usage : $(basename "${0}") [directory]"
	exit 1
fi

RUN=N
if [ "$(hostname)" != "StoneColdVL" ]; then
	echo "Do you want to do this now? [y|N]"
	read -r shouldwe
	if [[ ${shouldwe} =~ ^([yY][eE][sS]|[yY])$ ]]; then
		RUN=Y
	fi
fi

if [ "${RUN}" = "N" ]; then
	exit 1
fi

if [ "${EUID}" != "0" ]; then
	sudo "$0" "$*"
	exit "$?"
fi

echo "Start zero fill ${1}"
pushd . &> /dev/null
cd "${1}"
time bash <<EOF
cat /dev/zero > zero.fill 2> /dev/null;sync;sleep 1;sync;rm -f zero.fill
EOF
popd &> /dev/null
echo "End zero fill ${1}"

